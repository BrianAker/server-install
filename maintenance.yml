---
# Upgrade the fleet
- name: Maintenance
  hosts: all

  tasks:
    - name: Create groups by distribution
      group_by: key={{ansible_pkg_mgr}}

- hosts: yum
  tasks:
  - command: /usr/bin/yum -y upgrade
    sudo: yes
    tags: upgrade

- hosts: apt
  tasks:
  - apt: update_cache=yes
    sudo: yes
    tags: upgrade

  - apt: upgrade=dist cache_valid_time=3600
    sudo: yes
    tags: upgrade

  - command: apt-get autoremove -y
    sudo: yes
    tags: upgrade

  - command: apt-get clean
    sudo: yes
    tags: upgrade

  - command: shutdown -r now
    sudo: yes
