---
- name: Common Play
  hosts: all

  vars_files:
     - "vars/{{ ansible_os_family }}"
     - "vars/{{ ansible_distribution }}"
     - "vars/Defaults"

  tasks:
  - name: create ansible_distribution group
    group_by: key={{ ansible_distribution }}

  - name: create ansible_distribution group
    group_by: key={{ ansible_os_family }}

  - name: create ansible_pkg_mgr group
    group_by: key={{ ansible_pkg_mgr }}

  roles:
    - role: common
      User:
        name: deploy
        shell: "{{ default_shell }}"
        keychain: True
        is_admin: True
        is_remote: True

- hosts: Debian 
  roles:
  - role: jnv.unattended-upgrades
    unattended_allowed_origins: [security, updates]

- hosts: RedHat
  roles:
  - role: yum-cron

- hosts: Fedora
  tasks:
  - name: install packages with yum
    yum:  name={{ item }}
          state=present
    with_items:
    - tuned
    - tuned-utils
    sudo: yes
    tags: package_install
  service: >
            name=tuned
            state=started
            enabled=yes

- hosts: Ubuntu
  tasks:
  - apt:  update_cache=yes
          cache_valid_time=3600
          name={{ item }}
          state=present
    with_items:
    - powertop
    - pm-utils
    sudo: yes
    tags: package_install

  - command: pm-powersave true
    sudo: yes

- hosts: apt 
  tasks:
  - name: install packages with apt
    sudo: yes
    apt:  update_cache=yes
          cache_valid_time=3600
          name={{ item }}
          state=present
    with_items: packages[apt_packages] | default([])
    tags: package_install

- hosts: yum
  tasks:
  - name: install packages with yum
    sudo: yes
    yum:  name={{ item }}
          state=present
    with_items: packages[yum_packages] | default([])
    tags: package_install
