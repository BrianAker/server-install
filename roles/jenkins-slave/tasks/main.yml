---
- name: create jenkins user
  user: name=jenkins
        state=present 
        shell=/bin/bash

- name: Add keys for CI user
  ignore_errors: yes
  sudo: yes
  raw: sudo -u jenkins -i ssh-import-id d-ci

- name: chown jenkins/.ssh/authorized_keys
  file: path=~jenkins/.ssh/authorized_keys owner=jenkins group=jenkins mode=0600

- name: copy in pythonrc
  copy: src=templates/pythonrc 
        dest="/home/jenkins/.pythonrc"
        owner="jenkins"
        mode=0600

- name: Install Sphinx
  pip: name=$item state=latest
        virtualenv=~/.python
  with_items:
    - Sphinx
    - sphinxcontrib-googleanalytics

- name: Reconfigure path for jenkins user to include pythonrc
  lineinfile: dest=/home/jenkins/.profile
              regexp="^. ~/.pythonrc"
              line=". ~/.pythonrc"
              state=present
              create=yes

- name: Reconfigure SSH to allow jenkins user login
  lineinfile: dest=/etc/ssh/sshd_config 
              regexp="^AllowUsers jenkins"
              line="AllowUsers jenkins"
              state=present

- name: add jenkins user to mock group
  user: name=jenkins
        state=present 
        groups=mock
  when_string: $ansible_distribution == 'Fedora'
