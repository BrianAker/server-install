---
- command: yum clean expire-cache
  when: expire_cache is defined

- name: enable yum cache
  sudo: yes
  lineinfile: dest=/etc/yum.conf
              state=present
              regexp='^#?{{ item.key }}'
              line='{{ item.key }}={{ item.value }}'
#             validate='/usr/bin/yum list'
  with_items:
    - { key: 'keepcache', value: '1'}
  register: result
  tags: setup

- command: /usr/bin/yum makecache
  sudo: yes
  register: result
  tags: upgrade

- command: /usr/bin/yum list
  when: result|success
  sudo: yes
  tags: upgrade

- command: yum verify fedora-release
  when: ansible_distribution == 'Fedora'
  ignore_errors: yes
  register: returned

- name: reinstall fedora-release
  command: /usr/bin/yum reinstall -y fedora-release
  sudo: yes
  when: ansible_distribution == 'Fedora' and returned|success
  tags: upgrade

- command: /usr/bin/yum -y upgrade
  sudo: yes
  tags: upgrade
