---

- name: Add epel repository
  sudo: yes
  yum: name=http://mirror.pnl.gov/epel/6/x86_64/epel-release-6-8.noarch.rpm state=present
  when: ansible_distribution == 'CentOS'

- name: Create the GPG key for EPEL
  copy: src=RPM-GPG-KEY-EPEL-6 dest=/etc/pki/rpm-gpg
  when: ansible_distribution == 'CentOS' and ansible_distribution_version == '6.4'

- name: install basic software
  sudo: yes
  yum: name={{ item }}  state=present
  with_items:
    - '@minimal-environment'
    - '@system-tools'
    - redhat-lsb-core
    - python-setuptools
    - curl
    - bzr
    - sudo
    - fakeroot
    - git
    - make
    - perl
    - pkgconfig
    - python
    - ruby
    - tar
    - vim
    - wget
    - yum-cron

- name: set selinux
  sudo: yes
  lineinfile: dest=/etc/selinux/config regexp=^SELINUX= line=SELINUX=disabled

- name: install fedora basic software
  yum: name={{ item }}  state=present
  sudo: yes
  with_items:
    - denyhosts
    - fail2ban
    - firewalld
    - keychain
    - python-pip
    - python-virtualenv
  when: ansible_distribution == 'Fedora'

- name: yum distribution-synchronization
  sudo: yes
  raw: yum distribution-synchronization -y

- name: Install pip and virtualenv
  sudo: yes
  easy_install: name={{ item }}
  with_items:
    - virtualenv
    - pip
  when: ansible_distribution == 'CentOS'

- name: Reconfigure yum-cron to not just check
  sudo: yes
  lineinfile: dest=/etc/sysconfig/yum-cron
              regexp="^CHECK_ONLY"
              line="CHECK_ONLY=no"

- name: Reconfigure yum-cron to not just download
  sudo: yes
  lineinfile: dest=/etc/sysconfig/yum-cron
              regexp="^DOWNLOAD_ONLY"
              line="DOWNLOAD_ONLY=no"

- name: start yum-cron
  service: name=yum-cron
           state=restarted
           enabled=yes

- name: yum remove software
  sudo: yes
  yum: name={{ item }} state=absent
  ignore_errors: yes
  with_items:
    - BackupPC
  when: ansible_distribution == 'Fedora'
