---

- name: Add epel repository
  sudo: yes
  yum: name=http://mirror.pnl.gov/epel/6/x86_64/epel-release-6-8.noarch.rpm state=present
  when: ansible_distribution == 'CentOS'

- name: Create the GPG key for EPEL
  copy: src=RPM-GPG-KEY-EPEL-6 dest=/etc/pki/rpm-gpg
  when: ansible_distribution == 'CentOS' and ansible_distribution_version == '6.4'

- name: upgrade packages
  sudo: yes
  yum: name=*
       state=latest

- name: install basic software
  sudo: yes
  yum: name={{ item }}  state=present
  with_items:
    - '@minimal-environment'
    - '@system-tools'
    - redhat-lsb-core
    - python-setuptools
    - curl
    - bzr
    - sudo
    - fakeroot
    - git
    - make
    - perl
    - pkgconfig
    - python
    - ruby
    - tar
    - wget

- name: set selinux
  sudo: yes
  selinux: state=disabled
# Older method.
# lineinfile: dest=/etc/selinux/config regexp=^SELINUX= line=SELINUX=disabled

- name: install fedora basic software
  yum: name={{ item }}  state=present
  sudo: yes
  with_items:
    - denyhosts
    - fail2ban
    - firewalld
    - keychain
    - python-pip
    - python-virtualenv
  when: ansible_distribution == 'Fedora'

- name: Install pip and virtualenv
  sudo: yes
  easy_install: name={{ item }}
  with_items:
    - virtualenv
    - pip
  when: ansible_distribution == 'CentOS'

- name: yum remove software
  sudo: yes
  yum: name={{ item }} state=absent
  ignore_errors: yes
  with_items:
    - BackupPC
  when: ansible_distribution == 'Fedora'
