---
- name: include main sudo vars
  include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "{{ ansible_distribution }}.yml"
        - "{{ ansible_os_family }}.yml"
      paths: "{{ inventory_dir }}/roles/sudoers/vars/"

- group:  name=wheel
          state=present
  when: "ansible_distribution != 'MacOSX'"
  sudo: yes

- name: mkdir sudoers.d
  file: path="{{ sudoers_d }}"
        state=directory
        owner=root
        group="{{ root_group }}"
        mode=0750
  sudo: yes

- file: dest={{ sudoers_conf }}
        state=touch
        owner=root
        group="{{ root_group }}"
        mode=0440
  sudo: yes

- name: configure sudoers
  lineinfile: dest={{ sudoers_conf }}
              state=present
              regexp='^{{ item.key }}'
              line='{{ item.key }} {{ item.value }}'
              validate='visudo -cf %s'
  with_items:
    - { key: 'root', value: 'ALL=(ALL) ALL'}
    - { key: '#includedir', value: "{{ sudoers_d }}" }
  tags: config
  sudo: yes

- name: configure sudoers
  lineinfile: dest={{ sudoers_conf }}
              state=present
              regexp='^{{ item.key }}'
              line='{{ item.key }} {{ item.value }}'
              validate='visudo -cf %s'
  with_items:
    - { key: '%wheel', value: 'ALL=(ALL) NOPASSWD: ALL'}
  when: "ansible_distribution == 'FreeBSD'"
  tags: config
  sudo: yes
