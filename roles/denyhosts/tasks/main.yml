---
- name: /var/lib/denyhosts/allowed-hosts
  become: yes
  copy: src=allowed-hosts
        dest=/var/lib/denyhosts/allowed-hosts
  notify: restart denyhosts

- name: allow bastion hosts
  become: yes
  lineinfile: dest=/etc/hosts.allow
              regexp="^{{ item }}"
              line="{{ item }}"
              mode=0700
              state=present
              create=yes
  with_items: allowed_hosts

- name: Make sure sketch can login
  become: yes
  lineinfile: dest=/etc/denyhosts.conf
              regexp="^ALLOWED_HOSTS_HOSTNAME_LOOKUP="
              line="ALLOWED_HOSTS_HOSTNAME_LOOKUP=YES"
              mode=0700
              state=present
              create=yes
  notify: restart denyhosts

- name: enable denyhosts
  become: yes
  service:  name=denyhosts
            state=started
            enabled=yes
  notify: restart denyhosts
