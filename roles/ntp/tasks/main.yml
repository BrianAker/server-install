---
- debug:
    var: ntp_service[ansible_distribution]

- name: "yum install {{ ntp_packages[ansible_distribution] }}"
  sudo: yes
  yum: 
    name: "{{ item }}"
    state: present
  with_items: "{{ ntp_packages[ansible_os_family] }}"
  when: "ansible_pkg_mgr == 'yum'"

- name: "apt-get install {{ ntp_packages[ansible_os_family] }}"
  sudo: yes
  apt: 
    name: "{{ item }}"
    update_cache: yes
    cache_valid_time: 3600 
    state: present
  with_items: "{{ ntp_packages[ansible_os_family] }}"
  when: "ansible_pkg_mgr == 'apt'"

- name: "pkgng install {{ ntp_packages[ansible_os_family] }}"
  sudo: yes
  pkgng:
    name: "{{ item }}"
    state: present
  with_items: "{{ ntp_packages[ansible_os_family] }}"
  when: "ansible_pkg_mgr == 'pkgng'"

- name: enable ntpd service
  sudo: yes
  service:  
    name: "{{ ntp_service[ansible_distribution] }}"
    enabled: yes
    state: started
  notify: restart ntpd
  when: "ansible_os_family in ('RedHat', 'Debian')"
