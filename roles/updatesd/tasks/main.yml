---
- name: install updatesd
  sudo: yes
  yum: name=$item state=latest
  with_items:
    - yum-updatesd
  when_string: $ansible_distribution == 'Fedora'

- name: Reconfigure updatesd to install updates
  sudo: yes
  lineinfile: dest=/etc/yum/yum-updatesd.conf
              regexp="^do_update"
              line="do_update = yes"
  when_string: $ansible_distribution == 'Fedora'
  notify: restart updatesd

- name: Reconfigure updatesd to install updates
  sudo: yes
  lineinfile: dest=/etc/yum/yum-updatesd.conf
              regexp="^do_download"
              line="do_download = yes"
  when_string: $ansible_distribution == 'Fedora'
  notify: restart updatesd

- name: Reconfigure updatesd to install updates
  sudo: yes
  lineinfile: dest=/etc/yum/yum-updatesd.conf
              regexp="^do_download_deps"
              line="do_download_deps = yes"
  when_string: $ansible_distribution == 'Fedora'
  notify: restart updatesd


- name: install yum-cron
  sudo: yes
  yum: name=$item state=latest
  with_items:
    - yum-cron
  when_string: $ansible_distribution == 'CentOS'

- name: Reconfigure yum-cron to not just check
  sudo: yes
  lineinfile: dest=/etc/sysconfig/yum-cron
              regexp="^CHECK_ONLY"
              line="CHECK_ONLY=no"
  when_string: $ansible_distribution == 'CentOS'
  notify: restart yum-cron

- name: Reconfigure yum-cron to not just download
  sudo: yes
  lineinfile: dest=/etc/sysconfig/yum-cron
              regexp="^DOWNLOAD_ONLY"
              line="DOWNLOAD_ONLY=no"
  when_string: $ansible_distribution == 'CentOS'
  notify: restart yum-cron

- name: install apt unattended-upgrades
  sudo: yes
  apt: update_cache=yes cache_valid_time=3600 pkg=$item state=latest
  with_items:
    - update-manager-core
    - cron-apt
    - unattended-upgrades
  when_string: $ansible_os_family == 'Debian'

- name: Adjust APT update intervals
  sudo: yes
  copy: src=apt_periodic
        dest=/etc/apt/apt.conf.d/10periodic
  when_string: $ansible_os_family == 'Debian'

- name: Make sure unattended-security-upgrades work
  sudo: yes
  lineinfile: dest=/etc/apt/apt.conf.d/50unattended-upgrades
              regexp="-security"
              line='"${distro_id}:${distro_codename}-security";'
  when_string: $ansible_os_family == 'Debian'

- name: Make sure unattended-updates work
  sudo: yes
  lineinfile: dest=/etc/apt/apt.conf.d/50unattended-upgrades
              regexp="-updates"
              line='"${distro_id}:${distro_codename}-updates";'
  when_string: $ansible_os_family == 'Debian'
