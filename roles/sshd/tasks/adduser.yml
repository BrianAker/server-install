---
- fail: "sshd_allow_username was not defined."
  when: sshd_allow_username is not defined

- debug: msg="Adding user {{ sshd_allow_username }} with file {{ sshd_config_file }}"
  when: sshd_allow_username is defined

- name: update sshd AllowUsers
  sudo: yes
  lineinfile: dest={{ sshd_config_file }}
              regexp="^AllowUsers {{ sshd_allow_username }}"
              line="AllowUsers {{ sshd_allow_username }}"
              state=present
  notify: restart sshd
