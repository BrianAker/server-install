---
- debug:
    msg: "Adding user {{ User.name }} with file {{ sshd_config_file }}"
  when: User.name is defined

- name: update sshd AllowUsers
  sudo: yes
  lineinfile:
    dest: "{{ sshd_config_file }}"
    regexp: "^AllowUsers {{ User.name }}"
    line: "AllowUsers {{ User.name }}"
    state: present
  notify: restart sshd

- name: remove sshd AllowUsers User.name
  sudo: yes
  lineinfile: 
    dest: "{{ sshd_config_file }}"
    regexp: "AllowUsers User.name"
    state: absent
  notify: restart sshd
