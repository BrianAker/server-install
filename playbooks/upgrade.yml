--- # Upgrade the fleet
- name: yum/dnf hosts
  hosts: yum:dnf
  become: true
  tasks:
  - name: update metadata
    dnf:
      name: '*'
      state: latest
    become: true
    tags: upgrade
  - name: upgrade all packages
    dnf:
      name: '*'
      state: latest
    become: true
    tags: upgrade

- name: Upgrade apt based hosts
  hosts: apt
  become: true
  tasks:
  - name: Update apt cache
    apt:
      update_cache: yes
    become: true
    tags: upgrade

  - name: Upgrade apt dist
    apt:
      upgrade: yes
      cache_valid_time: 3600
      autoremove: yes
    become: true
    tags: upgrade

  - command: shutdown -r now
    become: true

- name: MacOSX
  hosts: MacOSX
  tasks:
  - name: Update homebrew
    homebrew:
      update_homebrew: true
    become: true
    tags: upgrade

  - name: Upgrade homebrew
    homebrew:
      upgrade_all: true
    become: true
    tags: upgrade

- name: Upgrade FreeBSD
  hosts: FreeBSD
  tasks:
  - raw: pkg upgrade -y
