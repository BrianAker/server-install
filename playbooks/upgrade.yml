--- # Upgrade the fleet
- name: yum/dnf hosts
  hosts: yum:dnf
  become: true
  tasks:
  - name: cleanup metadata
    command: dnf clean metadata
    become: true
    tags: upgrade
  - name: update metadata
    command: dnf upgrade --assumeyes
    become: true
    tags: upgrade
  - name: upgrade all packages
    dnf: name=* state=latest
    become: true
    tags: upgrade

- name: apt hosts
  hosts: apt
  become: true
  tasks:
  - apt: update_cache=yes
    become: true
    tags: upgrade

  - apt: upgrade=dist cache_valid_time=3600
    become: true
    tags: upgrade

  - command: apt-get autoremove -y
    become: true
    tags: upgrade

  - command: apt-get clean
    become: true
    tags: upgrade

  - command: shutdown -r now
    become: true

- name: MacOSX
  hosts: MacOSX
  tasks:
  - command: /usr/local/bin/brew update
    become: true
    tags: upgrade

  - command: /usr/local/bin/brew upgrade
    become: true
    tags: upgrade

- hosts: FreeBSD
  tasks:
  - raw: pkg upgrade -y
