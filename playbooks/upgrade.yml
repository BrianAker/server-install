--- # Upgrade the fleet
- name: yum/dnf hosts
  hosts: yum:dnf
  become: true
  tasks:
  - name: update metadata
    dnf:
      name: '*'
      state: latest
    become: true
    tags: upgrade
  - name: upgrade all packages
    dnf: name=* state=latest
    become: true
    tags: upgrade

- name: apt hosts
  hosts: apt
  become: true
  tasks:
  - apt:
      update_cache: yes
    become: true
    tags: upgrade

  - apt:
      upgrade: dist
      cache_valid_time: 3600
    become: true
    tags: upgrade

  - apt:
      autoremove: yes
    become: true
    tags: upgrade

  - command: shutdown -r now
    become: true

- name: MacOSX
  hosts: MacOSX
  tasks:
  - homebrew:
      update_homebrew: true
    become: true
    tags: upgrade

  - homebrew:
      upgrade_all: true
    become: true
    tags: upgrade

- hosts: FreeBSD
  tasks:
  - raw: pkg upgrade -y
